<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Space Fleet</title>
<style>
body {
  background:#0b0f1a;
  color:white;
  font-family:Arial;
  padding:20px;
}
button {
  padding:10px 16px;
  margin:5px 0;
  font-size:16px;
}
</style>
</head>
<body>

<h2>üöÄ Space Fleet</h2>

<div id="myRockets">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<hr>

<button onclick="buy('Scout')">–ö—É–ø–∏—Ç—å Scout (1‚≠ê)</button>
<button onclick="buy('Cargo')">–ö—É–ø–∏—Ç—å Cargo (25‚≠ê)</button>
<button onclick="buy('Fighter')">–ö—É–ø–∏—Ç—å Fighter (50‚≠ê)</button>

<script>
const tg = Telegram.WebApp;
tg.ready();

// --- –ü–û–õ–£–ß–ï–ù–ò–ï USER ID ---
if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
  alert("‚ùå –û—à–∏–±–∫–∞: –æ—Ç–∫—Ä–æ–π –º–∏–Ω–∏–∞–ø–ø —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ —á–∞—Ç–µ");
  throw new Error("No user");
}

const USER_ID = String(tg.initDataUnsafe.user.id);

// !!! –í–°–¢–ê–í–¨ –°–í–û–ô URL !!!
const API = "https://script.google.com/macros/s/AKfycbxVU91aKF0FEg9aawadhGijLgoExZts52Tj-XlZ3hTT8JyUzp3oxZicGSB6xBrhhDJm6w/exec";

// --- –ó–ê–ì–†–£–ó–ö–ê –†–ê–ö–ï–¢ ---
function loadRockets() {
  document.getElementById("myRockets").innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";

  fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "getRockets",
      user_id: USER_ID
    })
  })
  .then(r => r.json())
  .then(list => {
    if (!Array.isArray(list) || list.length === 0) {
      document.getElementById("myRockets").innerText = "üö´ –£ –≤–∞—Å –Ω–µ—Ç —Ä–∞–∫–µ—Ç";
      return;
    }

    document.getElementById("myRockets").innerHTML =
      "<b>–í–∞—à–∏ —Ä–∞–∫–µ—Ç—ã:</b><br>" +
      list.map(r => "üöÄ " + r.type).join("<br>");
  })
  .catch(() => {
    alert("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–∫–µ—Ç");
  });
}

// --- –ü–û–ö–£–ü–ö–ê ---
function buy(type) {
  tg.sendData(JSON.stringify({
    action: "buy_rocket",
    type: type
  }));
}

// --- –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–°–õ–ï –û–ü–õ–ê–¢–´ ---
tg.onEvent("web_app_data", () => {
  loadRockets();
});

loadRockets();
</script>

</body>
</html>
