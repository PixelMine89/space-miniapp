<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Space Fleet</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body {
  background:#0b1020;
  color:white;
  font-family:Arial;
  text-align:center;
}
.card {
  background:#151b35;
  margin:16px;
  padding:16px;
  border-radius:14px;
}
button {
  padding:12px 22px;
  margin:6px;
  font-size:16px;
  border-radius:10px;
  border:none;
}
</style>
</head>
<body>

<h2>üöÄ Space Fleet</h2>

<div class="card">
  <b>–ú–æ–∏ —Ä–∞–∫–µ—Ç—ã</b><br><br>
  <div id="rockets">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="card">
  <b>–ú–∞–≥–∞–∑–∏–Ω</b><br><br>
  <button onclick="buy('Scout')">Scout 1‚≠ê</button>
  <button onclick="buy('Cargo')">Cargo 25‚≠ê</button><br>
  <button onclick="buy('Fighter')">Fighter 50‚≠ê</button>
  <button onclick="buy('Explorer')">Explorer 100‚≠ê</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

const API = "https://script.google.com/macros/s/AKfycbzw3UglARKTQA_DW5YNfQvwa05IvDBDx6NR64nRwhXqIPB3yY_thTHS-XAejvxwe9RPzw/exec";

// ===== –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∫–µ—Ç =====
function loadRockets() {
  fetch(API, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      action: "getRockets",
      user_id: USER_ID
    })
  })
  .then(r => r.json())
  .then(list => {
    if (list.error) {
      document.getElementById("myRockets").innerText =
        "‚ùå " + list.error;
      return;
    }

    if (!list.length) {
      document.getElementById("myRockets").innerText = "–ù–µ—Ç —Ä–∞–∫–µ—Ç";
      return;
    }

    document.getElementById("myRockets").innerHTML =
      list.map(r => "üöÄ " + r.type).join("<br>");
  })
  .catch(() => {
    document.getElementById("myRockets").innerText = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
  });
}

// ===== –ø–æ–∫—É–ø–∫–∞ =====
function buy(type) {
  tg.sendData(JSON.stringify({
    action: "buy_rocket",
    type
  }));
}

// ===== –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã =====
tg.onEvent("visibility_changed", () => {
  if (tg.isVisible) loadRockets();
});

loadRockets();
</script>

</body>
</html>


