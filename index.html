<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h2>üöÄ –ú–æ–∏ —Ä–∞–∫–µ—Ç—ã</h2>
<div id="rockets">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<button onclick="buy('Alpha')">–ö—É–ø–∏—Ç—å Alpha</button>
<button onclick="buy('Beta')">–ö—É–ø–∏—Ç—å Beta</button>

<script>
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

const API = "http://–¢–í–û–ô_IP:8000";
let USER_ID = null;

// ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
fetch(API + "/auth", {
  method: "POST",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({ initData: tg.initData })
})
.then(r => r.json())
.then(res => {
  if (!res.ok) {
    document.getElementById("rockets").innerText = "‚ùå auth error";
    return;
  }
  USER_ID = res.telegram_id;
  loadRockets();
});


// ===== –ó–ê–ì–†–£–ó–ö–ê –†–ê–ö–ï–¢ =====
function loadRockets() {
  fetch(`${API}/rockets?telegram_id=${USER_ID}`)
    .then(r => r.json())
    .then(list => {
      if (list.length === 0) {
        document.getElementById("rockets").innerText = "–ù–µ—Ç —Ä–∞–∫–µ—Ç";
        return;
      }
      document.getElementById("rockets").innerHTML =
        list.map(r => "üöÄ " + r).join("<br>");
    });
}


// ===== –ü–û–ö–£–ü–ö–ê =====
function buy(type) {
  tg.sendData(JSON.stringify({
    action: "buy",
    type: type
  }));
}
</script>

</body>
</html>

