<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Space Fleet</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0b1020;
      color: #fff;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
    }

    .card {
      background: #151b35;
      margin: 15px;
      padding: 15px;
      border-radius: 12px;
    }

    button {
      background: #4da3ff;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>üöÄ Space Fleet</h1>

<div class="card">
  <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä.</p>
  <p>–£–ø—Ä–∞–≤–ª—è–π —Ä–∞–∫–µ—Ç–∞–º–∏ –∏ —ç–∫–æ–Ω–æ–º–∏–∫–æ–π.</p>
</div>

<div class="card">
  <p><b>Credits:</b> <span id="credits">0</span></p>
  <button onclick="addTestCredits()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫—Ä–µ–¥–∏—Ç—ã</button>
</div>

<div class="card">
  <p><b>–†–∞–∫–µ—Ç—ã:</b></p>
  <button onclick="addTestRocket('Scout')">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∫–µ—Ç—É Scout</button>
  <button onclick="addTestRocket('Cargo')">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∫–µ—Ç—É Cargo</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  // URL —Ç–≤–æ–µ–≥–æ Google Apps Script
  const API_URL = "https://script.google.com/macros/s/XXXXX/exec"; // <- –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL

  // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
  const userId = tg.initDataUnsafe.user.id;

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({action: "registerUser", user_id: userId})
  })
  .then(r => r.json())
  .then(data => {
    console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:", data);
    getUserData(); // —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  });

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  function getUserData() {
    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({action: "getUser", user_id: userId})
    })
    .then(r => r.json())
    .then(data => {
      console.log("User data:", data);
      if(data.credits !== undefined) {
        document.getElementById("credits").innerText = data.credits;
      }
    });
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤ (—Ç–µ—Å—Ç)
  function addTestCredits() {
    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({action: "addCredits", user_id: userId, amount: 10})
    })
    .then(r => r.json())
    .then(data => {
      console.log("Credits updated:", data);
      if(data.credits !== undefined) {
        document.getElementById("credits").innerText = data.credits;
      }
    });
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç—ã (—Ç–µ—Å—Ç)
  function addTestRocket(type) {
    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({action: "addRocket", user_id: userId, rocket_type: type})
    })
    .then(r => r.json())
    .then(data => {
      console.log("Rocket added:", data);
      alert("–†–∞–∫–µ—Ç–∞ " + type + " –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
    });
  }

</script>

</body>
</html>
