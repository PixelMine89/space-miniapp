<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Space Fleet</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      background:#0b1020;
      color:white;
      font-family:Arial;
      text-align:center;
      margin:0;
      padding:20px;
    }
    .card {
      background:#151b35;
      margin:15px 0;
      padding:15px;
      border-radius:12px;
    }
    button {
      padding:12px 20px;
      margin:6px;
      font-size:16px;
      border-radius:8px;
      border:none;
      cursor:pointer;
    }
  </style>
</head>
<body>

<h2>üöÄ Space Fleet</h2>

<div class="card">
  üí∞ Credits: <span id="credits">0</span>
</div>

<div class="card">
  <b>–ö—É–ø–∏—Ç—å —Ä–∞–∫–µ—Ç—É (Telegram ‚≠ê)</b><br>
  <button onclick="buyRocket('Scout', 10)">Scout (10‚≠ê)</button>
  <button onclick="buyRocket('Cargo', 25)">Cargo (25‚≠ê)</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

let pendingAction = null;

// —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Å—Ç–∞–≤–ª—è–µ–º)
fetch(API_URL, {
  method: "POST",
  body: JSON.stringify({ action: "register", user_id: userId })
}).then(loadUser);

// ====== –ü–û–ö–£–ü–ö–ê –†–ê–ö–ï–¢–´ ======
function buyRocket(type, price) {
  pendingAction = {
    action: "buy_rocket",
    type: type,
    price: price
  };

  tg.MainButton.setText(–ö—É–ø–∏—Ç—å ${type} –∑–∞ ${price} ‚≠ê);
  tg.MainButton.show();
}

// ====== –û–ë–†–ê–ë–û–¢–ö–ê MAIN BUTTON ======
tg.MainButton.onClick(() => {
  if (!pendingAction) return;

  tg.sendData(JSON.stringify(pendingAction));
  tg.MainButton.hide();
});

// ====== –ó–ê–ì–†–£–ó–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ======
function loadUser() {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "getUser", user_id: userId })
  })
  .then(r => r.json())
  .then(u => {
    document.getElementById("stars").innerText = u.stars || 0;
    document.getElementById("credits").innerText = u.credits || 0;
  });
}
</script>

</body>
</html>



